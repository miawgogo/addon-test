#!/usr/bin/with-contenv bashio
# vim: ft=bash
# shellcheck shell=bash
# ==============================================================================
# OpenThread BorderRouter start script
# ==============================================================================

# shellcheck disable=SC1091

if ! bashio::config.equals "meshprefix" ""; then
    PREFIX=$(bashio::config "meshprefix")

    prefix=$(echo "$PREFIX" | cut -d '/' -f1)
    prefix_len=$(echo "$PREFIX" | cut -d '/' -f2)
    # Always overwrite
    echo "" > /etc/radvd.conf 
    tee -a "/etc/radvd.conf" > /dev/null <<EOF
interface wpan0
{
    IgnoreIfMissing on;
    AdvCurHopLimit 0;
    AdvSendAdvert on;
        prefix ${prefix}/${prefix_len}
        {
            AdvOnLink on;
            AdvAutonomous on;
            AdvRouterAddr off;
            AdvPreferredLifetime 14400;
            AdvValidLifetime 86400;
        };
};
EOF

    /usr/sbin/radvd -n --logmethod stderr


fi

